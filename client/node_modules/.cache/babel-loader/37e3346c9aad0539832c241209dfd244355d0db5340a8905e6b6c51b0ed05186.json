{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useContext } from \"react\";\nimport { AuthContext } from \"../../contexts/authContext\";\nimport { request } from \"../../utils/axios\";\nexport const useUpdateUserMutation = () => {\n  _s();\n  const {\n    currentUser,\n    setCurrentUser\n  } = useContext(AuthContext);\n  const queryClient = useQueryClient();\n  const uploadProfileImage = async file => {\n    const formData = new FormData();\n    formData.append(\"file\", file);\n    const res = await request.post('/upload/userProfile', formData);\n    return res.data;\n  };\n  const uploadBackgroundImage = async file => {\n    const formData = new FormData();\n    formData.append(\"file\", file);\n    const res = await request.post('/upload/userBackground', formData);\n    return res.data;\n  };\n  const updateUser = async data => {\n    const {\n      name,\n      bio,\n      profile_img,\n      profile_bg_img\n    } = data;\n    const profileImageUrl = profile_img[0] ? await uploadProfileImage(profile_img[0]) : currentUser.profile_img;\n    const backgroundImageUrl = profile_bg_img[0] ? await uploadBackgroundImage(profile_bg_img[0]) : currentUser.profile_bg_img;\n    const user = {\n      name,\n      username: currentUser.username,\n      bio,\n      id: currentUser.id,\n      profile_img: profileImageUrl,\n      profile_bg_img: backgroundImageUrl\n    };\n    return request.post('/user', user).then(() => user);\n  };\n  const updateUserMutation = useMutation(data => updateUser(data).then(user => {\n    setCurrentUser(user);\n  }), {\n    onSuccess: () => {\n      queryClient.invalidateQueries(['profileUser', {\n        username: currentUser.username\n      }]);\n      queryClient.invalidateQueries(['postUser', {\n        user_id: currentUser.id\n      }]);\n    }\n  });\n  return {\n    updateUserMutation\n  };\n};\n_s(useUpdateUserMutation, \"pwc9egO6e5yIVXhfJ8xaRI8tXZw=\", false, function () {\n  return [useQueryClient, useMutation];\n});","map":{"version":3,"names":["useMutation","useQueryClient","useContext","AuthContext","request","useUpdateUserMutation","currentUser","setCurrentUser","queryClient","uploadProfileImage","file","formData","FormData","append","res","post","data","uploadBackgroundImage","updateUser","name","bio","profile_img","profile_bg_img","profileImageUrl","backgroundImageUrl","user","username","id","then","updateUserMutation","onSuccess","invalidateQueries","user_id"],"sources":["C:/Users/mathe/OneDrive/Documentos/vsc/fwitter/client/src/containers/profile/useUpdateUserMutation.js"],"sourcesContent":["import { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { useContext } from \"react\";\r\nimport { AuthContext } from \"../../contexts/authContext\";\r\nimport { request } from \"../../utils/axios\";\r\n\r\nexport const useUpdateUserMutation = () => {\r\n    const { currentUser, setCurrentUser } = useContext(AuthContext);\r\n    const queryClient = useQueryClient();\r\n\r\n    const uploadProfileImage = async (file) => {\r\n        const formData = new FormData();\r\n        formData.append(\"file\", file);\r\n        const res = await request.post('/upload/userProfile', formData);\r\n        return res.data;\r\n    }\r\n    \r\n    const uploadBackgroundImage = async (file) => {\r\n        const formData = new FormData();\r\n        formData.append(\"file\", file);\r\n        const res = await request.post('/upload/userBackground', formData);\r\n        return res.data;\r\n    }\r\n    \r\n    const updateUser = async data => {\r\n        const { name, bio, profile_img, profile_bg_img } = data;\r\n        const profileImageUrl = profile_img[0] ? \r\n            await uploadProfileImage(profile_img[0]) \r\n            : \r\n            currentUser.profile_img;\r\n\r\n        const backgroundImageUrl = profile_bg_img[0] ? \r\n            await uploadBackgroundImage(profile_bg_img[0]) \r\n            : \r\n            currentUser.profile_bg_img;\r\n    \r\n        const user = {\r\n            name,\r\n            username: currentUser.username,\r\n            bio,\r\n            id: currentUser.id,\r\n            profile_img: profileImageUrl,\r\n            profile_bg_img: backgroundImageUrl\r\n        };\r\n        \r\n        return request.post('/user', user).then(() => user);\r\n    }\r\n    \r\n    const updateUserMutation = useMutation(\r\n        (data) => updateUser(data).then((user) => {\r\n            setCurrentUser(user);\r\n        }), {\r\n                onSuccess: () => {\r\n                    queryClient.invalidateQueries(['profileUser', { \r\n                        username: currentUser.username\r\n                    }]);\r\n                    queryClient.invalidateQueries(['postUser', { \r\n                        user_id: currentUser.id \r\n                    }]);\r\n                }\r\n        }\r\n    )   \r\n\r\n    return { updateUserMutation };\r\n}\r\n\r\n\r\n\r\n\r\n"],"mappings":";AAAA,SAASA,WAAW,EAAEC,cAAc,QAAQ,uBAAuB;AACnE,SAASC,UAAU,QAAQ,OAAO;AAClC,SAASC,WAAW,QAAQ,4BAA4B;AACxD,SAASC,OAAO,QAAQ,mBAAmB;AAE3C,OAAO,MAAMC,qBAAqB,GAAG,MAAM;EAAA;EACvC,MAAM;IAAEC,WAAW;IAAEC;EAAe,CAAC,GAAGL,UAAU,CAACC,WAAW,CAAC;EAC/D,MAAMK,WAAW,GAAGP,cAAc,EAAE;EAEpC,MAAMQ,kBAAkB,GAAG,MAAOC,IAAI,IAAK;IACvC,MAAMC,QAAQ,GAAG,IAAIC,QAAQ,EAAE;IAC/BD,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAEH,IAAI,CAAC;IAC7B,MAAMI,GAAG,GAAG,MAAMV,OAAO,CAACW,IAAI,CAAC,qBAAqB,EAAEJ,QAAQ,CAAC;IAC/D,OAAOG,GAAG,CAACE,IAAI;EACnB,CAAC;EAED,MAAMC,qBAAqB,GAAG,MAAOP,IAAI,IAAK;IAC1C,MAAMC,QAAQ,GAAG,IAAIC,QAAQ,EAAE;IAC/BD,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAEH,IAAI,CAAC;IAC7B,MAAMI,GAAG,GAAG,MAAMV,OAAO,CAACW,IAAI,CAAC,wBAAwB,EAAEJ,QAAQ,CAAC;IAClE,OAAOG,GAAG,CAACE,IAAI;EACnB,CAAC;EAED,MAAME,UAAU,GAAG,MAAMF,IAAI,IAAI;IAC7B,MAAM;MAAEG,IAAI;MAAEC,GAAG;MAAEC,WAAW;MAAEC;IAAe,CAAC,GAAGN,IAAI;IACvD,MAAMO,eAAe,GAAGF,WAAW,CAAC,CAAC,CAAC,GAClC,MAAMZ,kBAAkB,CAACY,WAAW,CAAC,CAAC,CAAC,CAAC,GAExCf,WAAW,CAACe,WAAW;IAE3B,MAAMG,kBAAkB,GAAGF,cAAc,CAAC,CAAC,CAAC,GACxC,MAAML,qBAAqB,CAACK,cAAc,CAAC,CAAC,CAAC,CAAC,GAE9ChB,WAAW,CAACgB,cAAc;IAE9B,MAAMG,IAAI,GAAG;MACTN,IAAI;MACJO,QAAQ,EAAEpB,WAAW,CAACoB,QAAQ;MAC9BN,GAAG;MACHO,EAAE,EAAErB,WAAW,CAACqB,EAAE;MAClBN,WAAW,EAAEE,eAAe;MAC5BD,cAAc,EAAEE;IACpB,CAAC;IAED,OAAOpB,OAAO,CAACW,IAAI,CAAC,OAAO,EAAEU,IAAI,CAAC,CAACG,IAAI,CAAC,MAAMH,IAAI,CAAC;EACvD,CAAC;EAED,MAAMI,kBAAkB,GAAG7B,WAAW,CACjCgB,IAAI,IAAKE,UAAU,CAACF,IAAI,CAAC,CAACY,IAAI,CAAEH,IAAI,IAAK;IACtClB,cAAc,CAACkB,IAAI,CAAC;EACxB,CAAC,CAAC,EAAE;IACIK,SAAS,EAAE,MAAM;MACbtB,WAAW,CAACuB,iBAAiB,CAAC,CAAC,aAAa,EAAE;QAC1CL,QAAQ,EAAEpB,WAAW,CAACoB;MAC1B,CAAC,CAAC,CAAC;MACHlB,WAAW,CAACuB,iBAAiB,CAAC,CAAC,UAAU,EAAE;QACvCC,OAAO,EAAE1B,WAAW,CAACqB;MACzB,CAAC,CAAC,CAAC;IACP;EACR,CAAC,CACJ;EAED,OAAO;IAAEE;EAAmB,CAAC;AACjC,CAAC;AAAA,GA1DYxB,qBAAqB;EAAA,QAEVJ,cAAc,EAwCPD,WAAW;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}